 URL : "https://github.com/cmangos/issues/issues/1286" TITLE : bug warlockbugs he is bug BODY : current behavior : expected behavior : steps to reproduce : - // if this is a creature and it attacks from behind it has a probability to daze it's victim - if damageinfo->hitoutcome == melee_hit_crit || damageinfo->hitoutcome == melee_hit_crushing || damageinfo->hitoutcome == melee_hit_normal || damageinfo->hitoutcome == melee_hit_glancing && - gettypeid != typeid_player && ! creature this ->getcharmerorownerguid && !pvictim->hasinarc m_pi_f, this && damageinfo->totaldamage - { - // -probability is between 0% and 40% - // 20% base chance - float probability = 20.0f; - - // there is a newbie protection, at level 10 just 7% base chance; assuming linear function - if pvictim->getlevel < 30 - probability = 0.65f pvictim->getlevel + 0.5f; - - uint32 victimdefense = pvictim->getdefenseskillvalue ; - uint32 attackermeleeskill = getunitmeleeskill ; - - probability = attackermeleeskill / float victimdefense; - - if probability > 40.0f - probability = 40.0f; - - if roll_chance_f probability - castspell pvictim, 1604, triggered_old_triggered ; - } + // if this attack by an npc dealt some damage from behind to a player, it has a chance to daze victim + if damageinfo->totaldamage && candazeincombat pvictim && roll_chance_f calculateeffectivedazechance pvictim, damageinfo->attacktype + castspell pvictim, 1604, triggered_old_triggered ; client version : commit hash : database version : operating system : // : if this is a crash report, include the crashlog from a debug build with https://gist.github.com/ hit miss bugs 1级player and cer have 12%的miss
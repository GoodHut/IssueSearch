 URL : "https://github.com/NixOS/nixpkgs/issues/28816" TITLE : how to use impureenvvars BODY : issue description i'm trying to propagate http_proxy environment variable from the calling user environment to the builder environment. unfortunately, in the builder environment, i'm not able to get back this variable. steps to reproduce i run export impure=iop; nix-build -e 'with import <nixpkgs>{}; stdenv.mkderivation {name= impure ; phases= buildphase ; impureenvvars= impure ; buildphase= env | grep impure ;}' i get the following output these derivations will be built: /nix/store/dmyqgk19r871adr4a29q3cjkxrbgwkdz-impure.drv building path s ‘/nix/store/gqhbrlw9hjp6mm77zg5rmb6044xq4dby-impure’ building impureenvvars=impure buildphase=env | grep impure builder for ‘/nix/store/dmyqgk19r871adr4a29q3cjkxrbgwkdz-impure.drv’ failed to produce output path ‘/nix/store/gqhbrlw9hjp6mm77zg5rmb6044xq4dby-impure’ error: build of ‘/nix/store/dmyqgk19r871adr4a29q3cjkxrbgwkdz-impure.drv’ failed where i would expect to see impure=iop in the builder env. technical details system: nixos: nixos-version , ubuntu/fedora: lsb_release -a , ... nix version: run nix-env --version 1.11.8 and 1.11.13 nixpkgs version: run nix-instantiate --eval '<nixpkgs>' -a lib.nixpkgsversion 17.09pre-git nixpkgs commitid f7ae955bc2d6ab74ff396f2be14e42a712dba61c sandboxing enabled: run grep build-use-sandbox /etc/nix/nix.conf
 URL : "https://github.com/mindriot101/rust-fitsio/issues/41" TITLE : test errors on osx BODY : when running tests on osx in parallel i.e. by default, rather than with cargo test -- --test-threads 1 , the tests either segfaults or complains about too many i/o drivers. with lldb i can see that it's crashing in a stack of libsystem_c.dylib function calls: lldb bt 7 thread 2, name = 'fitsfile::test::cannot_write_column_to_image_hdu', stop reason = exc_bad_access code=1, address=0x68 frame 0: 0x00007fffc00576a0 libsystem_c.dylib flockfile + 4 frame 1: 0x00007fffc005a83c libsystem_c.dylib fwrite + 72 frame 2: 0x000000010030d231 libcfitsio.5.dylib file_write + 112 frame 3: 0x000000010030bd16 libcfitsio.5.dylib ffwrite + 50 frame 4: 0x0000000100300688 libcfitsio.5.dylib ffbfwt + 346 frame 5: 0x00000001003010b4 libcfitsio.5.dylib ffflsh + 58 frame 6: 0x00000001003032b1 libcfitsio.5.dylib ffclos + 158 this problem does not occur with single-threaded code, suggesting that it's a race condition or general threading bug in osx?! the problem does not happen in my virtual machine, even when running with 4 cores and multiple threads. i do not have a proper physical linux machine to test on :
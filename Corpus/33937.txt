 URL : "https://github.com/NebulousLabs/wal/issues/10" TITLE : bespoke wal metadata BODY : the wal is divided into 4096 byte pages. as a high performance library, we are trying to make things as fast and clean as possible. currently the wal metadata is an unknown number of bytes due to its json encoding. if we decide to change the magic or the version number, it could impact the number of bytes. also, how we decide to encode the json with or without whitespace can impact the number of bytes. we should transition the wal metadata to be bespoke. there are 3 pieces of information that are relevant, and i would like to fit them all into 16 bytes, while also being approximately human-readable meaning you can open it in vim and know the values : 1. name / magic. i propose we use 4 bytes for this: wal 2. verion. i propose we use 10 bytes for this: v1.0.0 . this gives us 2 bytes of spaces at the end that we can replace with something like v1.12.15 in the future if we ever get that far. honestly probably won't ever get beyond v1.0.0, but it's good to give yourself wiggle room. 3. clean shutdown indicator. we have 2 bytes for this, and ideally it should be human-readable if clean shutdown occurred. i am thinking c for 'clean shutdown' and u for 'unclean shutdown'. this bleeds over into the clean shutdown proposal that exists, but for this pr all we need is for the metadata function to accept a boolean indicating whether it is supposed to be marshaling for clean shutdown or unclean shutdown. and for all existing metadata calls, just assume unclean shutdown is what you should be marshaling. the clean shutdown proposal will fix everything else up.
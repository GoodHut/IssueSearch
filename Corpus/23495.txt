 URL : "https://github.com/sveltejs/svelte/issues/944" TITLE : post- 924 refactor BODY : 924 changed things round a bit, such that more analysis takes place in one go, at the start of the compilation process, rather than piecemeal later on through generator.contextualise . this means more stuff is shared between the dom and ssr compilers, for example. now that that's done, it might be good to get rid of generator.contextualise altogether — it's a bit of a strange beast, doing analysis and code transformation at the same time in a way that's a little inscrutable. my hunch is that things would become a bit simpler as a result. my hunch could be wrong through — there are basically three phases walktemplate , which is compiler-agnostic, preprocess , which is compiler-specific and sets things up for the final phase, and lastly the actual code generation . it might well turn out that we can't put more stuff into walktemplate because it depends on work that necessarily happens later. regardless, i'll leave this issue here to remind myself to look into it if i feel sufficiently motivated.
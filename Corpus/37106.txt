 URL : "https://github.com/toptal/chewy/issues/604" TITLE : keep definitions dry BODY : i am facing a problem with chewy and i am pretty sure there is a problem, but not sure if i am able to fix it: define_type issue do field :subject field :project do field :name field :identifier end end define_type wiki do field :subject field :content field :project do field :name field :identifier end end it's quite clear when i change project statement in one i have to do that in the second one too. so, what i can do: project_definition = proc.new { field :name field :identifier } define_type issue do field :subject field :project, &project_definition end define_type wiki do field :subject field :content field :project, &project_definition end that's probably the best solution, but it's better than nothing. unfortunately, it won't work. in lib/chewy/mapping.rb is method called expose_nested . this method yield accepted the block, this is a problem because blocks are some kind of closures. i am able to modify this to: def expand_nested field, &block @_current_field ||= root if @_current_field field.parent = @_current_field @_current_field.children.push field end return unless block_given? previous_field = @_current_field @_current_field = field instance_eval &block @_current_field = previous_field end this does not fail, bud it does not work either. projects and nested fields are not present after import
 URL : "https://github.com/philgyford/django-ditto/issues/174" TITLE : fix file downloader test BODY : the tests.core.test_utils.filedownloadertestcase.test_downloads_file generates this: ====================================================================== error: test_downloads_file tests.core.test_utils.filedownloadertestcase streams a jpg, saves it to /tmp/, returns the path, calls _make_filename_for_download . ---------------------------------------------------------------------- traceback most recent call last : file <string> , line 3, in wrapper file /users/phil/.pyenv/versions/3.5.1/lib/python3.5/unittest/mock.py , line 1157, in patched return func args, keywargs file /users/phil/projects/personal/django-ditto/tests/core/test_utils.py , line 131, in test_downloads_file filepath = self.do_download file /users/phil/projects/personal/django-ditto/tests/core/test_utils.py , line 123, in do_download return filedownloader.download self.url, 'image/jpeg' file /users/phil/projects/personal/django-ditto/ditto/core/utils/downloader.py , line 48, in download shutil.copyfileobj r.raw, f file /users/phil/projects/personal/django-ditto/.tox/py35-django110/lib/python3.5/shutil.py , line 73, in copyfileobj buf = fsrc.read length file /users/phil/projects/personal/django-ditto/.tox/py35-django110/lib/python3.5/site-packages/requests/packages/urllib3/response.py , line 380, in read data = self._fp.read amt valueerror: i/o operation on closed file. this happened when requests updated from v2.11.1 to v2.12.0. no idea quite what's causing that and have spent too long trying to fix it. http://stackoverflow.com/a/37283060/250962
 URL : "https://github.com/pysal/pysal/issues/1006" TITLE : kdtree error when k=1 BODY : - platform information: posix darwin - python version: 3.6.2 - scipy version: 0.19.1 - numpy version: 1.13.3 --- the following code import pysal as ps import numpy as np np.random.seed 42 lngs = np.random.uniform -180, 180, 100, 1 lats = np.random.uniform -90, 90, 100, 1 coords = np.hstack lngs, lats tree = ps.cg.kdtree coords, distance_metric='arc', radius=ps.cg.radius_earth_km print tree.query 90, 0 results in the following error: traceback most recent call last : file test.py , line 11, in <module> print tree.query 90, 0 file pythonenv/lib/python3.6/site-packages/pysal/cg/kdtree.py , line 161, in query dims = len d.shape attributeerror: 'float' object has no attribute 'shape' the issue is specifically here https://github.com/pysal/pysal/blob/8a487c10668496c68fd7f834c369c50b1506535c/pysal/cg/kdtree.py l161 . it seems that when k=1 the default argument , tree.query in scikit-learn returns a tuple of distance <float>, index <int> , so that line dims = len d.shape is trying to take the shape of a float. when k>1 , the tuple is distance <np.array>, index <np.array> , which allows the .shape call to work.
 URL : "https://github.com/apache/bookkeeper/issues/569" TITLE : run bookkeeper on java9 BODY : jira: https://issues.apache.org/jira/browse/bookkeeper-1049 reporter: enrico olivelli @eolivelli i am tring to run bookkeeper on java9, a part from simple issues:
- exclude the transitive dependency to jdk.tools in bookkeeer-benchmarks
- fix a warning due to the fact the class.forname in java9 is deprecated and we are running javac with the werror option warning = error we have a real stopper, in fact we want to access the low level id of filedescriptors using the reflaction and by default this is not allowed. this is the error: {code}
java.lang.assertionerror at org.apache.bookkeeper.util.nativeio.getfieldbyreflection nativeio.java:63 at org.apache.bookkeeper.util.nativeio.getsysfiledescriptor nativeio.java:75 at org.apache.bookkeeper.bookie.journalchannel.<init> journalchannel.java:218 at org.apache.bookkeeper.bookie.journalchannel.<init> journalchannel.java:97 at org.apache.bookkeeper.bookie.journalchannel.<init> journalchannel.java:86 at org.apache.bookkeeper.bookie.upgradetest.writejournal upgradetest.java:83 at org.apache.bookkeeper.bookie.upgradetest.newv1journaldirectory upgradetest.java:114 at org.apache.bookkeeper.bookie.upgradetest.testupgradev1tocurrent upgradetest.java:192 {code} comments from jira --- enrico olivelli 2017-05-08t13:11:05.656+0000 i am investigating if there is another way to access the information --- enrico olivelli 2017-05-09t06:45:14.292+0000 the best solution is to use native code to access the internal fd field inside the fielddescriptor object:
- we need the 'fd' only if we can load our native library
- accessing object internals using jni is allowed by jigsaw http://mail.openjdk.java.net/pipermail/core-libs-dev/2017-may/047510.html i will create a patch based on the work of bookkeeper-816 which introduces a bookkeeper specific native-io library
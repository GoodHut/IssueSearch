 URL : "https://github.com/socketry/nio4r/issues/163" TITLE : large time to respond BODY : i'm running some tests of falcon the web server which uses nio4r and in some cases it has a large response time. koyoko% wrk -c 32 -t 8 -d 10 http://localhost:9292/wiki/index running 10s test @ http://localhost:9292/wiki/index 8 threads and 32 connections thread stats avg stdev max +/- stdev latency 20.27ms 105.33ms 1.93s 98.79% req/sec 126.42 41.24 320.00 84.68% 8894 requests in 10.02s, 29.52mb read socket errors: connect 0, read 0, write 0, timeout 23 requests/sec: 887.48 transfer/sec: 2.95mb in the previous test, all 8 cores are pegged at 100% so i suppose it's reasonable that there are some issues. the issue is that invoking read_nonblock . the actual call returns right away with :wait_readable. however, waiting on that takes much longer than expected. perhaps the data is not there. or perhaps the selector is overloaded. it's not a huge number of connections. so, the delay is really in wait_readable which essentially registers a monitor and then returns back to the reactor. of course, if one fiber takes up time, it will block all others, so this is also something i'm investigating. any thoughts?
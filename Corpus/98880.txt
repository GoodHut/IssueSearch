 URL : "https://github.com/ArduPilot/ardupilot/issues/5523" TITLE : linux: crash in perf_begin BODY : i've had multiple crashes on disco with the following backtrace: 0 0x000de154 in linux::perf::begin void 1 0x000baa94 in navekf2_core::updatefilter bool i think the problem is a race condition in linux::perf::begin . it de-references the _perf_counters vector without a lock. if this happens while another thread is allocating a perf counter and that re-allocs the array then we can end up referencing old memory. the std::vector class is not thread-safe as has been discussed before . we can either add a lock which could be a performance bottleneck as we don't have rcu or we could make that vector a fixed length larger than the maximum expected number of perf counters. unfortunately i can only reproduce the issue when i don't build with debug enabled. that makes it hard to absolutely confirm the cause, but the symbols in the backtrace do make it seem likely. i think we need to look over all uses of std::vector to check they are used in a thread-safe manner.
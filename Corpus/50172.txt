 URL : "https://github.com/rsta2/circle/issues/39" TITLE : webserver memory leak BODY : hi! i've come across some memory leak problem in web server implementation. i can reproduce problem on example 21-webserver, on raspberry pi2. i first tried with arm_allow_multi_core + realtime settings in sysconfig.h, then with arm_allow_multi_core only setting, then with default settings, problem remain the same. what i do is flooding webserver with following command from my pc: curl -s http://192.168.1.118? 1-10000 what happens is that always after 457 successful replies raspberry hangs. i did some rough debugging, found that: - with mem_info i see that things get allocated but never freed, it looks like any connection is taking about 1 block of 262144, 2 blocks of 4096, 1 block of 1024; - with tcp_debug i've seen that connections stay stuck in fin-wait-1 state, as if tcptimertimewait never get called, so state never goes further to closing and tcpconnection never get deleted; - what is strange is that this happens only if i continuously do fast writing on screen without scrolling : i continuously call \b h sequence to go home with screen cursor, then call mem_info ; this results in seeing very fast update of memory consumption; in this conditions, example 21 hangs with even 1 connection, and connection last seen state is fin-wait-1; - if i remove the mem_info thing, but keep the tcp_debug thing, i see from the tcp log that 1 connection correctly terminates goes to closed state, and then i see deleted tcb message ; a connection flood anyway terminates with some not-well defined hang; that's what i've seen so far, hope it is useful : i may try some further debugging next days...
 URL : "https://github.com/elastic/elasticsearch/issues/23384" TITLE : histogram on an array BODY : describe the feature : this is a feature request. when we have an array of long/int, then a percentile or avg on such an array works correctly by considering the count of the array elements. but when histogram is requested, the current implementation of histogram works based on doc count. delete histperc put histperc put histperc/_mapping/t { properties : { name : { type : string }, avg : { type : long }, entries : { type : long }, count : { type : long } } } post /histperc/t/_bulk { index : { _id : e1 }} { name : get /login , avg : 2, entries : 2, 2, 2, 2, 2 , count : 5} { index : { _id : e2 }} { name : get /login , avg : 1, entries : 1, 1, 1 , count : 3} { index : { _id : e3 }} { name : get /login , avg : 7, entries : 7 , count : 1} { index : { _id : e4 }} { name : get /login , avg : 3, entries : 3 , count : 1} works correctly get /histperc/t/_search { aggs : { perc : { percentiles : { field : entries } } } } works correctly get /histperc/t/_search?size=0 { aggs : { average : { avg : { field : entries } } } } works based on doc count. interested in getting it to work with the values of the array instead get /histperc/t/_search { aggs : { hist : { histogram : { field : entries , interval : 1 } } } } the reason to request such a support is, in time-based data, most of the times the only change is in the value in this array and the rest of the elements are the same. hence, the cost of duplicating the documents is higher for this one feature of histogram, esp because avg and percentile already work correctly on this array.
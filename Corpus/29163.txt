 URL : "https://github.com/salt-formulas/salt-formula-linux/issues/125" TITLE : issues with selinux BODY : there is an issue with selinux.sls in redhat family os systems using selinux. 1. it is not possible to disable selinux, there is a condition that set system.selinux to permissive, if we define system.selinux disabled in pillars. 2. it looks like selinux_config is not necessary anymore selinux.mode will take care of variable change in /etc/selinux/config it is equal to run salt-call selinux.setenforce disabled locally. there is also an conflict with selinux_config to selinux.mode, so we should completely remove selinux_config. selinux.mode will writes values in upper letter disabled, permissive and enforcing to /etc/selinux/config the unless in selinux_config can't catch them because of grep does not ignore-case grep -i would also work pull request will follow for this issue: diff --git a/linux/system/selinux.sls b/linux/system/selinux.sls index 5bbd815..70186fb 100644 --- a/linux/system/selinux.sls +++ b/linux/system/selinux.sls @@ -7,18 +7,11 @@ include: {%- if grains.os_family == 'redhat' %} {%- if system.selinux == 'disabled' %} - {%- set mode = 'permissive' %} + {%- set mode = 'disabled' %} {%- else %} {%- set mode = system.selinux %} {%- endif %} -selinux_config: - cmd.run: - - name: sed -i 's/selinux= a-z a-z $/selinux={{ system.selinux }}/' /etc/selinux/config - - unless: grep 'selinux={{ system.selinux }}' /etc/selinux/config - - require: - - pkg: linux_repo_prereq_pkgs - {{ mode }}: selinux.mode
 URL : "https://github.com/nextcloud/server/issues/3271" TITLE : inefficient file search BODY : i'm running nc11.0.1 against a postgresql 9.5 database and have been logging long-running queries. all queries i found were related to the file search function. apparently search\pagedprovider isn't implemented for files, so all paging is done after a select without limit. the system has a user sharing with most other users, who owns 350k files at the moment, so a full search takes a while. while most queries looked like ... where name ilike '%abc%' , there've been some encounters of a '%%' search pattern. search.js checks for query.length > 2, but there seems to exist a corner case where the check is bypassed and a search pattern is requested. in the case of that 350k file user, all rows are retrieved from the database and filtered down to some 30 , which is quite an impact on the server. i tried switching provider\file to a pagedprovider implementing limit/offset in files/cache/cache.php, but this will create some cache problems with cache entries returned that don't fit the pattern .
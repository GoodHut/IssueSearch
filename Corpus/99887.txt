 URL : "https://github.com/yarnpkg/yarn/issues/3974" TITLE : node module dependency bug BODY : <!-- before creating an issue please make sure you are using the latest version of yarn. --> do you want to request a feature or report a bug ? bug <!-- is the feature a substantial feature request? please use https://github.com/yarnpkg/rfcs --> what is the current behavior? the requested package version is being ignored and substituted with a sub-package module in another dependency. if the current behavior is a bug, please provide the steps to reproduce. - create new project, run yarn init -y . - yarn add leaflet@1.0.x - yarn add leaflet-virtual-grid@latest - cd node_modules/leaflet-virtual-grid/node_modules/leaflet and vim package.json <!-- if you can, provide a link to a public repository which contains the files necessary to reproduce this. --> what is the expected behavior? when leaflet-virtual-grid is installed, its leaflet dependency shouldn't be installed, as it's already included previously. this is working correctly in npm v5. in npm v5, the node_modules for leaflet-virtual-grid are not installed and it will use the existing leaflet dependency. please mention your node.js, yarn and operating system version. - node.js - v8.1.4 - npm - v5.0.3 - yarn - v0.27.5 - macos - 10.12.5
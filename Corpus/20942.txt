 URL : "https://github.com/kubernetes/kubernetes/issues/56026" TITLE : device plugin race BODY : is this a bug report or feature request? : > uncomment only one, leave it on its own line: /kind bug /area hw-accelerators /sig node what happened : when re-writing the endpoint code i discovered that the mutex logic https://github.com/kubernetes/kubernetes/blob/6b97376a539c84b9bb11de5d44daeadf9930049e/pkg/kubelet/cm/deviceplugin/endpoint.go l96 is wrong and can lead to a data race while calling the device function. the current logic is a bit convoluted and would make more sense if the map was created in the for loop. however it seems like once the map is assigned to the structure, a device update while calling the device function will lead to a data race, anything else we need to know? : cc @jiayingz
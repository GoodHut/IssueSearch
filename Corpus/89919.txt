 URL : "https://github.com/thoughtbot/paperclip/issues/2479" TITLE : reprocess causes deadlock BODY : hi, we have a use case when we call reprocess! on after commit some styles aren't defined before the commit happened . but now reprocess causes another commit even if no attributes changed: .3.3 :001 > asset = assetfile.last assetfile load 0.5ms select assets . from assets where assets . type in 'assetfile' order by assets . id desc limit 1 => <assetfile id: 8646348, ...> 2.3.3 :002 > asset.data_file_name => ‘random’_-_mobile_phone_app.pdf 2.3.3 :003 > asset.data_file_name = asset.data_file_name => ‘random’_-_mobile_phone_app.pdf 2.3.3 :004 > asset.changes => {} 2.3.3 :005 > asset.data.reprocess! 0.2ms begin sql 0.4ms update assets set data_file_name = '‘random’_-_mobile_phone_app.pdf', data_updated_at = '2017-08-30 10:00:03', updated_at = '2017-08-30 10:00:03' where assets . id = 8646348 5.9ms commit => true you can see the data_file_name not changed but it still issues a commit. and this looks quite weird: 2.3.3 :006 > asset.changes => {} 2.3.3 :007 > asset.data.assign asset.data => <set: { data_file_name }> 2.3.3 :008 > asset.changes => { data_file_name => ‘random’_-_mobile_phone_app.pdf , ‘random’_-_mobile_phone_app.pdf , data_updated_at => wed, 30 aug 2017 06:00:03 edt -04:00, wed, 30 aug 2017 06:02:04 edt -04:00 } 2.3.3 :009 > asset.changes.values.map &:uniq => ‘random’_-_mobile_phone_app.pdf , ... for us, this is causing a deadlock since triggers a commit again and again.
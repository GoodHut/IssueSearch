 URL : "https://github.com/hapijs/lab/issues/756" TITLE : null request query BODY : hello i'm using lab to write some api tests and my routes have a pre function , and i'm getting always a null req.query here is my pre function code : const get_store_token = function req, rep { var store = req.query.shop_id || req.payload.shop_id; // hh-delightme //var store = req.payload.shop_id; // hh-delightme if store == 'undefined' { rep boom.create 400, shop parameter is missing ; }; model.get_store_token store .then data => { console.log json.stringify data ; let item = data.items 0 ; return rep item.shop_token ; //return rep 3853531c87ceec887dadda495e8855f7 ; } .catch err = new error => { boom.create 400, err.message, err ;; } ; }; my code for the test : it 'return shopper object when user found', done => { let options = { method: 'get', url: '/shopper', payload: { uid: '5590099717', shop_id : 'hh-delightme' } }; server.inject options, response => { //console.log response ; expect response .to.have.property 'data' ; done ; } ; } ; } ; > { message: 'an internal server error occurred', statuscode: 500, error: 'internal server error' } debug: internal, implementation, error typeerror: uncaught error: cannot read property 'shop_id' of null at get_store_token /home/hatim/delightme.io/services/shopper/index.js:16:53 can any one help me ? thanks
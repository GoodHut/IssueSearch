 URL : "https://github.com/httprb/form_data/issues/18" TITLE : buffer encoding issues BODY : i've been seeing some issues with this gem in jruby, that led me to this snippet here, where i think that some encoding mis-handling might be happening, and wanted to open the discussion before a pr is submitted. the snippet in question https://github.com/httprb/form_data/blob/master/lib/http/form_data/composite_io.rb l31-l44 was in my case shadowed by io.copy_stream, but the gist of it is: outbuf.to_s.replace will return an utf-8 string. @buffer is a binary string. outbuf << @buffer will not change the encoding in outbuf it'll remain utf-8 . @buffer.length != @buffer.bytesize i'd like to propose the following changes: all strings outbuf, @buffer should be binary current_io.read length, @buffer would anyways convert the buffer to binary if it were another encoding . switch to @buffer.bytesize ; switch to use .b for initialization because string.new.encoding , string.new .encoding ... .
 URL : "https://github.com/StackStorm/st2mistral/issues/28" TITLE : mistral slow shutdown BODY : over the past few weeks i've noticed st2ctl stop takes a fairly long time. doing a little digging tonight and i realized that the mistral service is the one that takes the longest to shut down. i decided to try and stop the service manually using systemctl stop mistral-server and it still took a long time. in fact it took 1 minute: root@stackstorm ~ time systemctl stop mistral real 1m0.024s user 0m0.002s sys 0m0.006s doing some grepping i found the configuration parameter rpc_response_timeout : https://github.com/stackstorm/mistral/blob/master/mistral/config.py l105 changing this value to something _other than_ 60 results in a _much_ quicker shutdown: with a value of 15: root@stackstorm ~ time systemctl stop mistral real 0m1.024s user 0m0.003s sys 0m0.007s with a value of 30: root@stackstorm ~ time systemctl stop mistral real 0m5.164s user 0m0.002s sys 0m0.008s with a value of 61 thanks @bigmstone : root@stackstorm ~ time systemctl stop mistral real 0m14.093s user 0m0.005s sys 0m0.009s and again with a value of 60: root@stackstorm ~ time systemctl stop mistral real 1m0.040s user 0m0.006s sys 0m0.006s it looks like the only place this value is used is here: https://github.com/stackstorm/mistral/blob/master/mistral/engine/rpc_backend/kombu/kombu_client.py l108 and the underlying data structure that's being used is a six.moves.queue.queue here https://github.com/stackstorm/mistral/blob/master/mistral/engine/rpc_backend/kombu/kombu_listener.py l42 the whole goal of this issue is simply to improve the shutdown time of the mistral service without degrading performance or data consistency of course .